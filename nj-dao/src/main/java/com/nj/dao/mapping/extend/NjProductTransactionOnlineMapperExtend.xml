<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nj.dao.extend.NjProductTransactionOnlineMapperExtend">
  <resultMap id="BaseResultMap" type="com.nj.model.generate.NjProductTransactionOnline">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 15 11:12:47 CST 2017.
    -->
    <id column="id" jdbcType="VARCHAR" property="id" />
    <result column="tcbl" jdbcType="VARCHAR" property="tcbl" />
    <result column="ptfwf" jdbcType="VARCHAR" property="ptfwf" />
    <result column="repay_way" jdbcType="VARCHAR" property="repayWay" />
    <result column="fee_type" jdbcType="INTEGER" property="feeType" />
    <result column="min_fee" jdbcType="DECIMAL" property="minFee" />
    <result column="max_fee" jdbcType="DECIMAL" property="maxFee" />
    <result column="fee_type1" jdbcType="INTEGER" property="feeType1" />
    <result column="min_fee1" jdbcType="DECIMAL" property="minFee1" />
    <result column="max_fee1" jdbcType="DECIMAL" property="maxFee1" />
    <result column="bond_type" jdbcType="INTEGER" property="bondType" />
    <result column="min_bond" jdbcType="DECIMAL" property="minBond" />
    <result column="max_bond" jdbcType="DECIMAL" property="maxBond" />
    <result column="bond_type1" jdbcType="INTEGER" property="bondType1" />
    <result column="min_bond1" jdbcType="DECIMAL" property="minBond1" />
    <result column="max_bond1" jdbcType="DECIMAL" property="maxBond1" />
    <result column="min_month_fee" jdbcType="DECIMAL" property="minMonthFee" />
    <result column="max_month_fee" jdbcType="DECIMAL" property="maxMonthFee" />
    <result column="drawing_control" jdbcType="INTEGER" property="drawingControl" />
    <result column="is_prepay_sup" jdbcType="INTEGER" property="isPrepaySup" />
    <result column="penalty_type" jdbcType="INTEGER" property="penaltyType" />
    <result column="is_del" jdbcType="INTEGER" property="isDel" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="is_online_sign" jdbcType="INTEGER" property="isOnlineSign" />
    <result column="contract_generation_type" jdbcType="INTEGER" property="contractGenerationType" />
  </resultMap>

  <select id="selectByOrderNo" parameterType="java.util.Map" resultMap="BaseResultMap">
	    select pto.* from nj_product_transaction_online pto where pto.id in (
		select ptr.transaction_id from nj_loan_order o LEFT JOIN nj_product_transaction_relative ptr 
		on o.product_id = ptr.product_id and ptr.transaction_type = #{type} where order_no = #{orderNo,jdbcType=VARCHAR}
	)
  </select>

	<select id="getOnlineByProductId" parameterType="java.util.Map"
	resultMap="BaseResultMap">
	SELECT
	pto.*
	FROM
	nj_product_transaction_online pto
	INNER JOIN nj_product_transaction_relative ptr
	ON pto.id=ptr.transaction_id
	AND ptr.product_id=#{productId,jdbcType=VARCHAR}
		<if test="transactionType != null and transactionType != ''">
			and  ptr.transaction_type=#{transactionType,jdbcType=VARCHAR}
		</if>
	</select>
  
  <select id="selectOffByOrderNo" parameterType="java.util.Map" resultType="java.util.HashMap">
	    select pto.contract_generation_type as contractGenerationType,pto.repay_way as repayWay,pto.month_fee as monthFee from nj_product_transaction_offline pto where pto.id in (
		select ptr.transaction_id from nj_loan_order o LEFT JOIN nj_product_transaction_relative ptr 
		on o.product_id = ptr.product_id and ptr.transaction_type = 0 where order_no = #{orderNo,jdbcType=VARCHAR}
	)
  </select>
  
</mapper>